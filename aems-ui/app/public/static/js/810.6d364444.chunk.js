"use strict";(self.webpackChunkaems_client=self.webpackChunkaems_client||[]).push([[810],{74810:function(e,n,i){i.r(n),i.d(n,{default:function(){return D}});var t=i(1413),s=i(93433),r=i(4942),a=i(15671),l=i(43144),d=i(60136),o=i(43668),c=i(9418),u=i(50698),h=i(36625),v=i(23122),m=i(72791),f=i(60364),p=i(763),x=i(46513),g=i(17113),j=i(696),w=i(64695),y=i(43334),A=i(85084),C=i(62333),k=i(95785),S=i(97626),b=i(80184),N={dictionary:(0,t.Z)((0,t.Z)({},y.F),A.F),graphs:y.x,translations:C.Z};w.Mu.setOptions(N);var R=function(e){(0,d.Z)(i,e);var n=(0,o.Z)(i);function i(e){var t;return(0,a.Z)(this,i),(t=n.call(this,e)).handleChange=function(e,n){return function(i){var s,a,l=t.state.editing;switch(e){case"role":var d=void 0===n?t.state.role:(0,p.get)(l,"role",null!==(s=null===n||void 0===n?void 0:n.role)&&void 0!==s?s:"");i=(0,p.xor)(d.split(" "),[i]).join(" ");case"name":case"email":case"password":case"verify":return t.setState(void 0===n?(0,r.Z)({},e,i):{editing:(0,p.merge)(l,(0,r.Z)({},e,i))});case"units":return t.setState(void 0===n?{units:(0,p.xor)(t.state.units,[{id:i}])}:{editing:(0,p.merge)(l,{units:(0,p.xor)(null!==(a=null===l||void 0===l?void 0:l.units)&&void 0!==a?a:[],[{id:i}])})});default:throw new Error("Unhandled field passed to handleChange function.")}}},t.handleCreate=function(){var e=t.state,n=e.name,i=e.email,s=e.role,r=e.password;t.props.createUser({name:n,email:i,role:s,password:r}),t.setState({name:"",email:"",role:"",password:"",verify:"",units:[],editing:null,show:null})},t.handleEdit=function(e){var n=e.id;t.setState({editing:{id:n,password:"",verify:""}})},t.handleCancel=function(){t.setState({editing:null})},t.handleSave=function(){var e,n,i,r=t.props.user,a=(0,p.omit)(null===(e=t.state)||void 0===e?void 0:e.editing,["verify"].concat((0,s.Z)(null!==(n=t.state)&&void 0!==n&&null!==(i=n.editing)&&void 0!==i&&i.password?[]:["password"])));t.isAdmin()?(a&&t.props.updateUser(a),t.setState({editing:null})):(a&&t.props.updateCurrent(a),t.setState({editing:r?{id:r.id,password:"",verify:""}:null}))},t.handleDelete=function(e){var n=e.id;void 0!==n&&t.props.deleteUser(n)},t.state={name:"",email:"",role:"",password:"",verify:"",units:[],editing:null,show:null},t}return(0,l.Z)(i,[{key:"componentDidMount",value:function(){var e=this.props.user;this.isAdmin()?this.props.readUsers():this.setState({editing:e?{id:e.id,password:"",verify:""}:null})}},{key:"isCreate",value:function(){var e,n=this.state,i=n.name,t=n.email,s=n.role,r=n.password,a=n.verify;if(!(i&&t&&r))return!1;var l=this.getErrors(i,t,s,r,a);return!(l.email||l.name||l.verify||(null===(e=l.password)||void 0===e?void 0:e.feedback.warning))}},{key:"isSave",value:function(e){var n,i=this.state.editing,t=(0,p.merge)({verify:""},e,this.state.editing),s=t.name,r=t.email,a=t.role,l=t.password,d=t.verify,o=this.getErrors(s,r,a,l,d),c=(0,p.merge)({},e,i),u=o.email||o.name||o.verify||(null===(n=o.password)||void 0===n?void 0:n.feedback.warning),h=!(0,p.isEqual)((0,p.merge)({password:""},e),(0,p.omit)(c,["verify"]));return!u&&h}},{key:"isAdmin",value:function(){var e,n,i=this.props.user;return(e=j.GD.Admin).granted.apply(e,(0,s.Z)(null!==(n=null===i||void 0===i?void 0:i.role.split(" "))&&void 0!==n?n:[""]))}},{key:"parseRole",value:function(e){return{roles:e.split(" ").map((function(e){var n;return null===(n=j.GD.parse(e))||void 0===n?void 0:n.name})).filter((function(e){return!!e})),grants:(0,p.uniq)((0,p.flatten)(e.split(" ").map((function(e){var n;return null===(n=j.GD.parse(e))||void 0===n?void 0:n.grants})))).filter((function(e){return!!e}))}}},{key:"getUnits",value:function(e){var n,i=this.props.units;return null!==(n=null===i||void 0===i?void 0:i.filter((function(n){var i;return!(null===(i=e.units)||void 0===i||!i.find((function(e){return n.id===e.id})))})))&&void 0!==n?n:[]}},{key:"getErrors",value:function(e,n,i,t,s){return{name:""!==e&&e.length<2?"User name must be specified.":null,email:""===n||/^[\w-.]+@([\w-]+\.)+[\w-]{2,4}$/i.test(n)?null:"Valid email must be specified.",password:""===t?null:(0,w.tu)(null!==t&&void 0!==t?t:"",[e,n]),verify:""===t||t===s?null:"New password and verify password must match."}}},{key:"renderAccount",value:function(e){var n=this,i=this.props.units,t=this.state.show,s=e?(0,p.merge)({verify:""},e,this.state.editing):this.state,r=s.name,a=s.email,l=s.role,d=s.password,o=s.verify,h=this.parseRole(l),m=h.roles,f=h.grants,x=e?this.getUnits(e):[],g=e?"edit-pw":"create-pw",w=e?"edit-pwv":"create-pwv",y=this.getErrors(r,a,l,d,o);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(c.__,{children:[(0,b.jsx)("b",{children:"Name"}),(0,b.jsx)(c.BZ,{type:"text",value:r,onChange:function(i){return n.handleChange("name",e)(i.target.value)},readOnly:!this.isAdmin(),intent:y.name?u.S.DANGER:void 0,rightElement:(0,b.jsx)("div",{className:"icons",children:y.name&&(0,b.jsx)(k.u,{content:y.name,children:(0,b.jsx)(c.JO,{className:"icon",icon:v.AlY,intent:u.S.DANGER})})})})]}),(0,b.jsxs)(c.__,{children:[(0,b.jsx)("b",{children:"Email"}),(0,b.jsx)(c.BZ,{type:"text",value:a,onChange:function(i){return n.handleChange("email",e)(i.target.value)},readOnly:!this.isAdmin(),intent:y.email?u.S.DANGER:void 0,rightElement:(0,b.jsx)("div",{className:"icons",children:y.email&&(0,b.jsx)(k.u,{content:y.email,children:(0,b.jsx)(c.JO,{className:"icon",icon:v.AlY,intent:u.S.DANGER})})})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(c.__,{children:[(0,b.jsx)("b",{children:"New Password"}),(0,b.jsx)(c.BZ,{type:t===g?"text":"password",autoComplete:"new-password",value:d,onChange:function(i){return n.handleChange("password",e)(i.target.value)},intent:y.password&&(y.password.feedback.warning||y.password.feedback.suggestions.length>0)?y.password.feedback.warning?u.S.DANGER:u.S.WARNING:void 0,rightElement:(0,b.jsxs)("div",{className:"icons",children:[y.password&&(y.password.feedback.warning||y.password.feedback.suggestions.length>0)&&(0,b.jsx)(k.u,{content:y.password.feedback.warning||y.password.feedback.suggestions.join(" \n"),children:(0,b.jsx)(c.JO,{className:"icon",icon:v.AlY,intent:y.password.feedback.warning?u.S.DANGER:u.S.WARNING})}),(0,b.jsx)(c.zx,{minimal:!0,icon:t===g?v.Sk0:v.BF5,onClick:function(){return n.setState({show:t===g?null:g})}})]})})]}),(0,b.jsxs)(c.__,{children:[(0,b.jsx)("b",{children:"Verify Password"}),(0,b.jsx)(c.BZ,{type:t===w?"text":"password",value:o,onChange:function(i){return n.handleChange("verify",e)(i.target.value)},intent:y.verify?u.S.DANGER:void 0===y.verify?void 0:u.S.NONE,rightElement:(0,b.jsxs)("div",{className:"icons",children:[y.verify&&(0,b.jsx)(k.u,{content:y.verify,children:(0,b.jsx)(c.JO,{className:"icon",icon:v.AlY,intent:u.S.DANGER})}),(0,b.jsx)(c.zx,{minimal:!0,icon:t===w?v.Sk0:v.BF5,onClick:function(){return n.setState({show:t===w?null:w})}})]})})]})]}),(0,b.jsx)("div",{children:(0,b.jsxs)(c.__,{children:[(0,b.jsx)("b",{children:"Roles"}),j.GD.values.map((function(i){return(0,b.jsx)(c.XZ,{id:i.name,label:"".concat(i.label," Role"),checked:m.includes(i.name),indeterminate:!m.includes(i.name)&&f.includes(i.name),onChange:function(){return n.handleChange("role",e)(i.name)},disabled:!n.isAdmin()},"cb-role-".concat(i.name))}))]})}),(0,b.jsx)("div",{children:(0,b.jsxs)(c.__,{children:[(0,b.jsx)("b",{children:"Units"}),null===i||void 0===i?void 0:i.map((function(i){return(0,b.jsx)(c.XZ,{id:String(i.id),label:i.label,checked:!!x.find((function(e){return e.id===i.id})),onChange:function(){return n.handleChange("units",e)(i.id)},disabled:!n.isAdmin()},"cb-unit-".concat(i.id))}))]})})]})}},{key:"renderMyAccount",value:function(){var e=this.props.user;return this.isAdmin()||!e?null:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h2",{children:"My Account"}),(0,b.jsx)("div",{className:"create",children:(0,b.jsxs)(c.Zb,{interactive:!0,children:[this.renderAccount(e),(0,b.jsx)("div",{children:(0,b.jsx)(c.zx,{icon:v.$eC,intent:u.S.PRIMARY,minimal:!0,onClick:this.handleSave,disabled:!this.isSave(e)})})]})})]})}},{key:"renderCreateAccount",value:function(){return this.isAdmin()?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h2",{children:"Create Account"}),(0,b.jsx)("div",{className:"create",children:(0,b.jsxs)(c.Zb,{interactive:!0,children:[this.renderAccount(),(0,b.jsx)("div",{children:(0,b.jsx)(c.zx,{icon:v.RPl,intent:u.S.PRIMARY,minimal:!0,onClick:this.handleCreate,disabled:!this.isCreate()})})]})})]}):null}},{key:"renderAccountList",value:function(){var e=this;if(!this.isAdmin())return null;var n=this.props.filtered,i=this.state.editing;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h1",{children:"Accounts"}),(0,b.jsx)("div",{className:"list",children:null===n||void 0===n?void 0:n.map((function(n,t){return n.id===(null===i||void 0===i?void 0:i.id)?(0,b.jsxs)(c.Zb,{interactive:!0,children:[e.renderAccount(n),(0,b.jsxs)("div",{children:[(0,b.jsx)(c.zx,{icon:v.$eC,intent:u.S.PRIMARY,minimal:!0,onClick:function(){return e.handleSave()},disabled:!e.isSave(n)}),(0,b.jsx)(c.zx,{icon:v.eV6,intent:u.S.PRIMARY,minimal:!0,onClick:function(){return e.handleCancel()}})]})]},n.id||t):(0,b.jsxs)(c.Zb,{interactive:!0,children:[(0,b.jsx)("div",{children:n.name}),(0,b.jsx)("div",{children:n.email}),(0,b.jsx)("div",{children:n.role}),(0,b.jsxs)("div",{children:[(0,b.jsx)(c.zx,{icon:v.dme,intent:u.S.PRIMARY,minimal:!0,onClick:function(){return e.handleEdit(n)}}),(0,b.jsx)(c.zx,{icon:v.R4W,intent:u.S.WARNING,minimal:!0,onClick:function(){return e.handleDelete(n)}})]})]},n.id||t)}))})]})}},{key:"render",value:function(){return(0,b.jsxs)("div",{className:"account",children:[(0,b.jsx)(h.h4,(0,t.Z)({},this.props)),this.renderMyAccount(),this.renderCreateAccount(),this.renderAccountList()]})}}]),i}(m.Component),Z={readUsers:x._V,filterUsers:x.nv,createUser:x.r4,updateUser:x.Nq,deleteUser:x.h8,updateCurrent:g.Nq},E=(0,f.$j)((function(e){return{user:(0,g.dy)(e),accounts:(0,x.YN)(e),filtered:(0,x.Gp)(e),units:(0,S.OB)(e)}}),Z)(R),G=i(9153),D=function(e){return(0,b.jsx)(G.Z,(0,t.Z)((0,t.Z)({},e),{},{renderRoute:function(e){return(0,b.jsx)(E,(0,t.Z)({},e))}}))}}}]);
//# sourceMappingURL=810.6d364444.chunk.js.map