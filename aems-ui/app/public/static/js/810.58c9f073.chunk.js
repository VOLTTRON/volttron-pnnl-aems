"use strict";(self.webpackChunkaems_client=self.webpackChunkaems_client||[]).push([[810],{74810:function(e,n,i){i.r(n),i.d(n,{default:function(){return D}});var t=i(1413),s=i(93433),r=i(4942),a=i(15671),l=i(43144),d=i(60136),o=i(43668),c=i(9418),u=i(50698),h=i(36625),v=i(23122),m=i(72791),p=i(60364),f=i(763),x=i(46513),g=i(17113),j=i(696),w=i(64695),y=i(43334),A=i(85084),C=i(62333),k=i(95785),b=i(97626),S=i(80184),N={dictionary:(0,t.Z)((0,t.Z)({},y.F),A.F),graphs:y.x,translations:C.Z};w.Mu.setOptions(N);var R=function(e,n){return(0,f.isArray)(n)?n:e},Z=function(e){(0,d.Z)(i,e);var n=(0,o.Z)(i);function i(e){var t;return(0,a.Z)(this,i),(t=n.call(this,e)).handleChange=function(e,n){return function(i){var s,a,l,d=t.state.editing;switch(e){case"role":var o=void 0===n?t.state.role:(0,f.get)(d,"role",null!==(s=null===n||void 0===n?void 0:n.role)&&void 0!==s?s:"");i=(0,f.xor)(o.split(" "),[i]).join(" ");case"name":case"email":case"password":case"verify":return t.setState(void 0===n?(0,r.Z)({},e,i):{editing:(0,f.merge)(d,(0,r.Z)({},e,i))});case"units":return t.setState(void 0===n?{units:(0,f.xorWith)(t.state.units,[{id:i}],f.isEqual)}:{editing:(0,f.mergeWith)({},d,{units:(0,f.xorWith)(null!==(a=null!==(l=null===d||void 0===d?void 0:d.units)&&void 0!==l?l:n.units)&&void 0!==a?a:[],[{id:i}],f.isEqual)},R)});default:throw new Error("Unhandled field passed to handleChange function.")}}},t.handleCreate=function(){var e=t.state,n=e.name,i=e.email,s=e.role,r=e.password;t.props.createUser({name:n,email:i,role:s,password:r}),t.setState({name:"",email:"",role:"",password:"",verify:"",units:[],editing:null,show:null})},t.handleEdit=function(e){var n=e.id;t.setState({editing:{id:n,password:"",verify:""}})},t.handleCancel=function(){t.setState({editing:null})},t.handleSave=function(){var e,n,i,r=t.props.user,a=(0,f.omit)(null===(e=t.state)||void 0===e?void 0:e.editing,["verify"].concat((0,s.Z)(null!==(n=t.state)&&void 0!==n&&null!==(i=n.editing)&&void 0!==i&&i.password?[]:["password"])));t.isAdmin()?(a&&t.props.updateUser(a),t.setState({editing:null})):(a&&t.props.updateCurrent(a),t.setState({editing:r?{id:r.id,password:"",verify:""}:null}))},t.handleDelete=function(e){var n=e.id;void 0!==n&&t.props.deleteUser(n)},t.state={name:"",email:"",role:"",password:"",verify:"",units:[],editing:null,show:null},t}return(0,l.Z)(i,[{key:"componentDidMount",value:function(){var e=this.props.user;this.isAdmin()?this.props.readUsers():this.setState({editing:e?{id:e.id,password:"",verify:""}:null}),this.props.readUnits()}},{key:"isCreate",value:function(){var e,n=this.state,i=n.name,t=n.email,s=n.role,r=n.password,a=n.verify;if(!(i&&t&&r))return!1;var l=this.getErrors(i,t,s,r,a);return!(l.email||l.name||l.verify||(null===(e=l.password)||void 0===e?void 0:e.feedback.warning))}},{key:"isSave",value:function(e){var n,i=this.state.editing,t=(0,f.mergeWith)({},e,this.state.editing,R),s=t.name,r=t.email,a=t.role,l=t.password,d=t.verify,o=this.getErrors(s,r,a,l,d),c=(0,f.mergeWith)({},e,i,R),u=o.email||o.name||o.verify||(null===(n=o.password)||void 0===n?void 0:n.feedback.warning),h=!(0,f.isEqual)((0,f.merge)({password:""},e),(0,f.omit)(c,["verify"]));return!u&&h}},{key:"isAdmin",value:function(){var e,n,i=this.props.user;return(e=j.GD.Admin).granted.apply(e,(0,s.Z)(null!==(n=null===i||void 0===i?void 0:i.role.split(" "))&&void 0!==n?n:[""]))}},{key:"parseRole",value:function(e){return{roles:e.split(" ").map((function(e){var n;return null===(n=j.GD.parse(e))||void 0===n?void 0:n.name})).filter((function(e){return!!e})),grants:(0,f.uniq)((0,f.flatten)(e.split(" ").map((function(e){var n;return null===(n=j.GD.parse(e))||void 0===n?void 0:n.grants})))).filter((function(e){return!!e}))}}},{key:"getUnits",value:function(e){var n,i=this.props.units;return(null!==(n=null===i||void 0===i?void 0:i.filter((function(n){return!(null===e||void 0===e||!e.find((function(e){return n.id===e.id})))})))&&void 0!==n?n:[]).sort((function(e,n){return e.label.localeCompare(n.label)}))}},{key:"getErrors",value:function(e,n,i,t,s){return{name:""!==e&&e.length<2?"User name must be specified.":null,email:""===n||/^[\w-.]+@([\w-]+\.)+[\w-]{2,4}$/i.test(n)?null:"Valid email must be specified.",password:""===t?null:(0,w.tu)(null!==t&&void 0!==t?t:"",[e,n]),verify:""===t||t===s?null:"New password and verify password must match."}}},{key:"renderAccount",value:function(e){var n=this,i=this.props.units,t=this.state.show,s=e?(0,f.mergeWith)({},e,this.state.editing,R):this.state,r=s.name,a=s.email,l=s.role,d=s.password,o=s.verify,h=s.units,m=this.parseRole(l),p=m.roles,x=m.grants,g=this.getUnits(h),w=e?"edit-pw":"create-pw",y=e?"edit-pwv":"create-pwv",A=this.getErrors(r,a,l,d,o);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{children:[(0,S.jsxs)(c.__,{children:[(0,S.jsx)("b",{children:"Name"}),(0,S.jsx)(c.BZ,{type:"text",value:r,onChange:function(i){return n.handleChange("name",e)(i.target.value)},readOnly:!this.isAdmin(),intent:A.name?u.S.DANGER:void 0,rightElement:(0,S.jsx)("div",{className:"icons",children:A.name&&(0,S.jsx)(k.u,{content:A.name,children:(0,S.jsx)(c.JO,{className:"icon",icon:v.AlY,intent:u.S.DANGER})})})})]}),(0,S.jsxs)(c.__,{children:[(0,S.jsx)("b",{children:"Email"}),(0,S.jsx)(c.BZ,{type:"text",value:a,onChange:function(i){return n.handleChange("email",e)(i.target.value)},readOnly:!this.isAdmin(),intent:A.email?u.S.DANGER:void 0,rightElement:(0,S.jsx)("div",{className:"icons",children:A.email&&(0,S.jsx)(k.u,{content:A.email,children:(0,S.jsx)(c.JO,{className:"icon",icon:v.AlY,intent:u.S.DANGER})})})})]})]}),(0,S.jsxs)("div",{children:[(0,S.jsxs)(c.__,{children:[(0,S.jsx)("b",{children:"New Password"}),(0,S.jsx)(c.BZ,{type:t===w?"text":"password",autoComplete:"new-password",value:d,onChange:function(i){return n.handleChange("password",e)(i.target.value)},intent:A.password&&(A.password.feedback.warning||A.password.feedback.suggestions.length>0)?A.password.feedback.warning?u.S.DANGER:u.S.WARNING:void 0,rightElement:(0,S.jsxs)("div",{className:"icons",children:[A.password&&(A.password.feedback.warning||A.password.feedback.suggestions.length>0)&&(0,S.jsx)(k.u,{content:A.password.feedback.warning||A.password.feedback.suggestions.join(" \n"),children:(0,S.jsx)(c.JO,{className:"icon",icon:v.AlY,intent:A.password.feedback.warning?u.S.DANGER:u.S.WARNING})}),(0,S.jsx)(c.zx,{minimal:!0,icon:t===w?v.Sk0:v.BF5,onClick:function(){return n.setState({show:t===w?null:w})}})]})})]}),(0,S.jsxs)(c.__,{children:[(0,S.jsx)("b",{children:"Verify Password"}),(0,S.jsx)(c.BZ,{type:t===y?"text":"password",value:o,onChange:function(i){return n.handleChange("verify",e)(i.target.value)},intent:A.verify?u.S.DANGER:void 0===A.verify?void 0:u.S.NONE,rightElement:(0,S.jsxs)("div",{className:"icons",children:[A.verify&&(0,S.jsx)(k.u,{content:A.verify,children:(0,S.jsx)(c.JO,{className:"icon",icon:v.AlY,intent:u.S.DANGER})}),(0,S.jsx)(c.zx,{minimal:!0,icon:t===y?v.Sk0:v.BF5,onClick:function(){return n.setState({show:t===y?null:y})}})]})})]})]}),(0,S.jsx)("div",{children:(0,S.jsxs)(c.__,{children:[(0,S.jsx)("b",{children:"Roles"}),j.GD.values.map((function(i){return(0,S.jsx)(c.XZ,{id:i.name,label:"".concat(i.label," Role"),checked:p.includes(i.name),indeterminate:!p.includes(i.name)&&x.includes(i.name),onChange:function(){return n.handleChange("role",e)(i.name)},disabled:!n.isAdmin()},"cb-role-".concat(i.name))}))]})}),(0,S.jsx)("div",{children:(0,S.jsxs)(c.__,{children:[(0,S.jsx)("b",{children:"Units"}),null===i||void 0===i?void 0:i.map((function(i){return(0,S.jsx)(c.XZ,{id:String(i.id),label:i.label,checked:!!g.find((function(e){return e.id===i.id})),onChange:function(){return n.handleChange("units",e)(i.id)},disabled:!n.isAdmin()},"cb-unit-".concat(i.id))}))]})})]})}},{key:"renderMyAccount",value:function(){var e=this.props.user;return this.isAdmin()||!e?null:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("h2",{children:"My Account"}),(0,S.jsx)("div",{className:"create",children:(0,S.jsxs)(c.Zb,{interactive:!0,children:[this.renderAccount(e),(0,S.jsx)("div",{children:(0,S.jsx)(c.zx,{icon:v.$eC,intent:u.S.PRIMARY,minimal:!0,onClick:this.handleSave,disabled:!this.isSave(e)})})]})})]})}},{key:"renderCreateAccount",value:function(){return this.isAdmin()?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("h2",{children:"Create Account"}),(0,S.jsx)("div",{className:"create",children:(0,S.jsxs)(c.Zb,{interactive:!0,children:[this.renderAccount(),(0,S.jsx)("div",{children:(0,S.jsx)(c.zx,{icon:v.RPl,intent:u.S.PRIMARY,minimal:!0,onClick:this.handleCreate,disabled:!this.isCreate()})})]})})]}):null}},{key:"renderAccountList",value:function(){var e=this;if(!this.isAdmin())return null;var n=this.props.filtered,i=this.state.editing;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("h1",{children:"Accounts"}),(0,S.jsx)("div",{className:"list",children:null===n||void 0===n?void 0:n.map((function(n,t){return n.id===(null===i||void 0===i?void 0:i.id)?(0,S.jsxs)(c.Zb,{interactive:!0,children:[e.renderAccount(n),(0,S.jsxs)("div",{children:[(0,S.jsx)(c.zx,{icon:v.$eC,intent:u.S.PRIMARY,minimal:!0,onClick:function(){return e.handleSave()},disabled:!e.isSave(n)}),(0,S.jsx)(c.zx,{icon:v.eV6,intent:u.S.PRIMARY,minimal:!0,onClick:function(){return e.handleCancel()}})]})]},n.id||t):(0,S.jsxs)(c.Zb,{interactive:!0,children:[(0,S.jsx)("div",{children:n.name}),(0,S.jsx)("div",{children:n.email}),(0,S.jsx)("div",{children:n.role}),(0,S.jsxs)("div",{children:[(0,S.jsx)(c.zx,{icon:v.dme,intent:u.S.PRIMARY,minimal:!0,onClick:function(){return e.handleEdit(n)}}),(0,S.jsx)(c.zx,{icon:v.R4W,intent:u.S.WARNING,minimal:!0,onClick:function(){return e.handleDelete(n)}})]})]},n.id||t)}))})]})}},{key:"render",value:function(){return(0,S.jsxs)("div",{className:"account",children:[(0,S.jsx)(h.h4,(0,t.Z)({},this.props)),this.renderMyAccount(),this.renderCreateAccount(),this.renderAccountList()]})}}]),i}(m.Component),E={readUsers:x._V,readUnits:b.Vh,filterUsers:x.nv,createUser:x.r4,updateUser:x.Nq,deleteUser:x.h8,updateCurrent:g.Nq},G=(0,p.$j)((function(e){return{user:(0,g.dy)(e),accounts:(0,x.YN)(e),filtered:(0,x.Gp)(e),units:(0,b.OB)(e)}}),E)(Z),U=i(9153),D=function(e){return(0,S.jsx)(U.Z,(0,t.Z)((0,t.Z)({},e),{},{renderRoute:function(e){return(0,S.jsx)(G,(0,t.Z)({},e))}}))}}}]);
//# sourceMappingURL=810.58c9f073.chunk.js.map