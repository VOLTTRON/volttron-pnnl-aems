ARG VOLTTRON_CAMPUS=${VOLTTRON_CAMPUS}
ARG VOLTTRON_BUILDING=${VOLTTRON_BUILDING}
ARG VOLTTRON_PREFIX=${VOLTTRON_PREFIX}
ARG VOLTTRON_GATEWAY_ADDRESS=${VOLTTRON_GATEWAY_ADDRESS}
ARG VOLTTRON_TIMEZONE=${VOLTTRON_TIMEZONE}
ARG GRAFANA_DB_NAME=${GRAFANA_DB_NAME}
ARG GRAFANA_DB_USER=${GRAFANA_DB_USER}
ARG GRAFANA_DB_PASSWORD=${GRAFANA_DB_PASSWORD}
ARG GRAFANA_DB_HOST=${GRAFANA_DB_HOST}
ARG GRAFANA_DB_PORT=${GRAFANA_DB_PORT}
ARG GRAFANA_URL=${GRAFANA_URL}
ARG GRAFANA_USERNAME=${GRAFANA_USERNAME}
ARG GRAFANA_PASSWORD=${GRAFANA_PASSWORD}
ARG GRAFANA_VERIFY_SSL=${GRAFANA_VERIFY_SSL}
FROM python:3
# arguments
ARG HTTP_PROXY
ARG HTTPS_PROXY
ARG NO_PROXY

ENV HTTP_PROXY=${HTTP_PROXY}
ENV HTTPS_PROXY=${HTTPS_PROXY}
ENV NO_PROXY=${NO_PROXY}

# Set Volttron and Grafana environment variables
ENV VOLTTRON_CAMPUS=${VOLTTRON_CAMPUS}
ENV VOLTTRON_BUILDING=${VOLTTRON_BUILDING}
ENV VOLTTRON_PREFIX=${VOLTTRON_PREFIX}
ENV VOLTTRON_GATEWAY_ADDRESS=${VOLTTRON_GATEWAY_ADDRESS}
ENV VOLTTRON_TIMEZONE=${VOLTTRON_TIMEZONE}
ENV GRAFANA_DB_NAME=${GRAFANA_DB_NAME}
ENV GRAFANA_DB_USER=${GRAFANA_DB_USER}
ENV GRAFANA_DB_PASSWORD=${GRAFANA_DB_PASSWORD}
ENV GRAFANA_DB_HOST=${GRAFANA_DB_HOST}
ENV GRAFANA_DB_PORT=${GRAFANA_DB_PORT}
ENV GRAFANA_URL=${GRAFANA_URL}
ENV GRAFANA_USERNAME=${GRAFANA_USERNAME}
ENV GRAFANA_PASSWORD=${GRAFANA_PASSWORD}
ENV GRAFANA_VERIFY_SSL=${GRAFANA_VERIFY_SSL}

# Copy the scripts
WORKDIR /home/user/
COPY . .

# Make setup scripts executable and run main setup script
WORKDIR /home/user/
RUN chmod +x setup.sh setup-volttron.sh setup-grafana.sh

CMD ["./setup.sh"]
